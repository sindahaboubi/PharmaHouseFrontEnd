<div class="container">
  <h2>Votre Panier</h2>
  
  <div *ngIf="cart.length === 0 && !factureVisible"  class="alert alert-info">
    Votre panier est vide.
  </div>
  
  <div *ngIf="cart.length > 0">
    <ul class="list-group mb-3">
      <li class="list-group-item" *ngFor="let item of cart">
        <div class="row align-items-center">
          <div class="col-md-2">
            <img [src]="getMedicamentImageUrl(item.medicament)" class="img-fluid rounded" alt="{{ item.medicament.titre }}">
          </div>
          
          <div class="col-md-4">
            <h5>{{ item.medicament.titre }}</h5>
            <p><strong>Prix: </strong>{{ item.medicament.prix }} DT</p>
          </div>
          
          <div class="col-md-3">
            <p><strong>Quantité: </strong>{{ item.quantity }}</p>
            <p><strong>Prix total: </strong>{{ item.quantity * item.medicament.prix }} DT</p>
          </div>
          
          <div class="col-md-3 text-right">
            <button class="btn btn-sm btn-danger" (click)="removeFromCart(item)">
              <i class="fas fa-trash-alt"></i> Supprimer
            </button>
          </div>
        </div>
      </li>
    </ul>
    
    <div class="text-right">
      <p><strong>Prix total du panier: </strong>{{ calculateTotalCartPrice() }} DT</p>
    </div>
    
    <div class="text-center">
      <button class="btn btn-danger" (click)="clearCart()">Vider le panier</button>
    </div>

    <div class="text-center mt-3">
      <button class="btn btn-success" (click)="showAddressForm()">Passer la commande</button>
    </div>

    <div *ngIf="showAddressInput" class="mt-3">
      <textarea class="form-control mb-3" [(ngModel)]="shippingAddress" placeholder="Entrez votre adresse de livraison"></textarea>
      <button class="btn btn-primary" (click)="createCommande()">Confirmer la commande</button>
    </div>
  </div>

  <div id="facture-content" *ngIf="factureVisible" class="facture-container">
    <div class="facture-header">
      <img src="assets/logo.png" alt="Logo" class="logo">
      <div class="header-text">
        <h2>Facture</h2>
        <p>Commande numéro:{{ commandeResponse.id}} </p>
      </div>
    </div>
    
    <div class="facture-details">
      <div class="user-details">
        <p><strong>ID Utilisateur:</strong> {{ user.id }}</p>
        <p><strong>Nom Utilisateur:</strong> {{ user.name }}</p>
        <p><strong>Email Utilisateur:</strong> {{ user.email }}</p>
        <p><strong>Adresse de livraison:</strong> {{ shippingAddress }}</p>
      </div>
      
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Produit</th>
            <th>Quantité</th>
            <th>Prix unitaire (DT)</th>
            <th>Total (DT)</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of commandeResponse.ligneDeCommandes">
            <td>
              <img [src]="getMedicamentImageUrl(item.medicament)" alt="{{ item.medicament.titre }}" class="medicament-image">
              {{ item.medicament.titre }}
            </td>
            <td>{{ item.quantite }}</td>
            <td>{{ item.medicament.prix }}</td>
            <td>{{ item.quantite * item.medicament.prix }}</td>
          </tr>
        </tbody>
      </table>
      
      <div class="total-price">
        <p><strong>Prix total du panier: </strong>{{ calculateFactureTotal() }} DT</p>
      </div>
      
      <p class="thank-you">Merci pour votre commande!</p>
    </div>
  </div>
  
  
  
  
    <!-- Download button for the facture PDF -->
    <div style="text-align: center; margin-top: 20px;" *ngIf="factureVisible" class="facture-container">
      <button class="btn btn-primary" (click)="downloadFacturePDF()">Télécharger Facture</button>
    </div>